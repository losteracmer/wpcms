<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!-- Tell the browser to be responsive to screen width -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">
	<!-- Favicon icon -->
	<link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png">
	<title>客户详情</title>
	<!-- Custom CSS -->
	<link href="dist/css/style.min.css" rel="stylesheet">
	<link href="./assets/libs/toastr/build/toastr.min.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>
	<!-- ============================================================== -->
	<!-- Preloader - style you can find in spinners.css -->
	<!-- ============================================================== -->
	<div class="preloader">
		<div class="lds-ripple">
			<div class="lds-pos"></div>
			<div class="lds-pos"></div>
		</div>
	</div>
	<!-- ============================================================== -->
	<!-- Main wrapper - style you can find in pages.scss -->
	<!-- ============================================================== -->
	<div id="main-wrapper">
		<!-- ============================================================== -->
		<!-- Topbar header - style you can find in pages.scss -->
		<!-- ============================================================== -->
		<header class="topbar">
			<nav class="navbar top-navbar navbar-expand-md navbar-dark">
				<div class="navbar-header">
					<!-- This is for the sidebar toggle which is visible on mobile only -->
					<a class="nav-toggler waves-effect waves-light d-block d-md-none" href="javascript:void(0)">
						<i class="ti-menu ti-close"></i>
					</a>
					<!-- ============================================================== -->
					<!-- Logo -->
					<!-- ============================================================== -->
					<div class="navbar-brand">
						<a href="index.html" class="logo">
							<!-- Logo icon -->
							<b class="logo-icon">
								<!--You can put here icon as well // <i class="wi wi-sunset"></i> //-->
								<!-- Dark Logo icon -->
								<img src="assets/images/logo-icon.png" alt="homepage" class="dark-logo" />
								<!-- Light Logo icon -->
								<img src="assets/images/logo-light-icon.png" alt="homepage" class="light-logo" />
							</b>
							<!--End Logo icon -->
							<!-- Logo text -->
							<span class="logo-text">
								<!-- dark Logo text -->
								<img src="assets/images/logo-text.png" alt="homepage" class="dark-logo" />
								<!-- Light Logo text -->
								<img src="assets/images/logo-light-text.png" class="light-logo" alt="homepage" />
							</span>
						</a>
					</div>
					<!-- ============================================================== -->
					<!-- End Logo -->
					<!-- ============================================================== -->
					<!-- ============================================================== -->
					<!-- Toggle which is visible on mobile only -->
					<!-- ============================================================== -->
					<a class="topbartoggler d-block d-md-none waves-effect waves-light" href="javascript:void(0)" data-toggle="collapse"
					 data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
						<i class="ti-more"></i>
					</a>
				</div>
				<!-- ============================================================== -->
				<!-- End Logo -->
				<!-- ============================================================== -->
				<div class="navbar-collapse collapse" id="navbarSupportedContent">
					<!-- ============================================================== -->
					<!-- toggle and nav items -->
					<!-- ============================================================== -->
					<ul class="navbar-nav float-left mr-auto">
						<!-- <li class="nav-item d-none d-md-block">
                            <a class="nav-link sidebartoggler waves-effect waves-light" href="javascript:void(0)" data-sidebartype="mini-sidebar">
                                <i class="mdi mdi-menu font-24"></i>
                            </a>
                        </li> -->
						<!-- ============================================================== -->
						<!-- Search -->
						<!-- ============================================================== -->
						<li class="nav-item search-box">
							<a class="nav-link waves-effect waves-dark" href="javascript:void(0)">
								<div class="d-flex align-items-center">
									<i class="mdi mdi-magnify font-20 mr-1"></i>
									<div class="ml-1 d-none d-sm-block">
										<span>Search</span>
									</div>
								</div>
							</a>
							<form class="app-search position-absolute">
								<input type="text" class="form-control" placeholder="这个功能还没开发哦~~~~">
								<a class="srh-btn">
									<i class="ti-close"></i>
								</a>
							</form>
						</li>
					</ul>
					<!-- ============================================================== -->
					<!-- Right side toggle and nav items -->
					<!-- ============================================================== -->
					<ul class="navbar-nav float-right">
						<!-- ============================================================== -->
						<!-- Messages -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle waves-effect waves-dark" href="" id="2" data-toggle="dropdown" aria-haspopup="true"
							 aria-expanded="false">
								<i class="font-22 mdi mdi-email-outline"></i>

							</a>
							<div class="dropdown-menu dropdown-menu-right mailbox animated bounceInDown" aria-labelledby="2">
								<span class="with-arrow">
									<span class="bg-danger"></span>
								</span>
								<ul class="list-style-none">
									<li>
										<div class="drop-title text-white bg-danger">
											<h4 class="m-b-0 m-t-5">2新消息</h4>
											<span class="font-light">信息内容</span>
										</div>
									</li>
									<li>
										<div class="message-center message-body">
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="assets/images/users/1.jpg" alt="user" class="rounded-circle">
													<span class="profile-status online pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">员工小王</h5>
													<span class="mail-desc">永阳花苑发水了，飞流直下，无法控制</span>
													<span class="time">9:30 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="user-img">
													<img src="assets/images/users/2.jpg" alt="user" class="rounded-circle">
													<span class="profile-status busy pull-right"></span>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">管理员</h5>
													<span class="mail-desc">老板，新机器有大牛5000￥购买30台，卖否？</span>
													<span class="time">19:10 AM</span>
												</div>
											</a>
										</div>
									</li>
									<li>
										<a class="nav-link text-center link text-dark" href="javascript:void(0);">
											<b>开发中~~~QAQ</b>
											<i class="fa fa-angle-right"></i>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- End Messages -->
						<!-- ============================================================== -->
						<!-- ============================================================== -->
						<!-- Comment -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown border-right">
							<a class="nav-link dropdown-toggle waves-effect waves-dark" href="" data-toggle="dropdown" aria-haspopup="true"
							 aria-expanded="false">
								<i class="mdi mdi-bell-outline font-22"></i>
								<span class="badge badge-pill badge-info noti"></span>
							</a>
							<div class="dropdown-menu dropdown-menu-right mailbox animated bounceInDown">
								<span class="with-arrow">
									<span class="bg-primary"></span>
								</span>
								<ul class="list-style-none">
									<li>
										<div class="drop-title bg-primary text-white">
											<h4 class="m-b-0 m-t-5">4 New</h4>
											<span class="font-light">提醒</span>
										</div>
									</li>
									<li>
										<div class="message-center notifications">
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-danger btn-circle">
													<i class="fa fa-link"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">提示</h5>
													<span class="mail-desc">有位客户说今天给他换处理器</span>
													<span class="time">9:30 AM</span>
												</div>
											</a>
											<!-- Message -->
											<a href="javascript:void(0)" class="message-item">
												<span class="btn btn-success btn-circle">
													<i class="ti-calendar"></i>
												</span>
												<div class="mail-contnet">
													<h5 class="message-title">备忘</h5>
													<span class="mail-desc">明天放假，下班打卡别忘关灯</span>
													<span class="time">9:10 AM</span>
												</div>
											</a>
											
										</div>
									</li>
									<li>
										<a class="nav-link text-center m-b-5 text-dark" href="javascript:void(0);">
											<strong>开发中~~~QAQ</strong>
											<i class="fa fa-angle-right"></i>
										</a>
									</li>
								</ul>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- End Comment -->
						<!-- ============================================================== -->
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle waves-effect waves-dark pro-pic" href="" data-toggle="dropdown" aria-haspopup="true"
							 aria-expanded="false">
								<img id="adminAvatarUrl" src="assets/images/users/2.jpg" alt="user" class="rounded-circle" width="40">
								<span id="adminNickName" class="m-l-5 font-medium d-none d-sm-inline-block">loading... <i class="mdi mdi-chevron-down"></i></span>
							</a>
							<div class="dropdown-menu dropdown-menu-right user-dd animated flipInY">
								<span class="with-arrow">
									<span class="bg-primary"></span>
								</span>
								<div class="d-flex no-block align-items-center p-15 bg-primary text-white m-b-10">
									<div class="">
										<img id="adminAvatarUrl2" src="assets/images/users/2.jpg" alt="user" class="rounded-circle" width="60">
									</div>
									<div class="m-l-10">
										<h4 id="adminNickName2" class="m-b-0">loading...</h4>
										<p id="adminAccount" class=" m-b-0">loading...</p>
									</div>
								</div>
								<a class="dropdown-item" href="javascript:void(0)">
									<i class="ti-user m-r-5 m-l-5"></i> 我的描述</a>
								<div class="dropdown-divider"></div>
								<a class="dropdown-item" href="javascript:void(0)">
									<i class="ti-settings m-r-5 m-l-5"></i> 账户设置</a>
								<div class="dropdown-divider"></div>
								<a id="logoutBtn" class="dropdown-item" href="javascript:void(0)">
									<i class="fa fa-power-off m-r-5 m-l-5"></i> 退出登录</a>
								<div class="dropdown-divider"></div>
								<div class="p-l-30 p-10">
									<a href="javascript:void(0)" class="btn btn-sm btn-success btn-rounded">关于</a>
								</div>
							</div>
						</li>
						<!-- ============================================================== -->
						<!-- User profile and search -->
						<!-- ============================================================== -->
					</ul>
				</div>
			</nav>
		</header>
		<!-- ============================================================== -->
		<!-- End Topbar header -->
		<!-- ============================================================== -->
		<!-- ============================================================== -->
		<!-- Left Sidebar - style you can find in sidebar.scss  -->
		<!-- ============================================================== -->
		<aside class="left-sidebar">
			<!-- Sidebar scroll-->
			<div class="scroll-sidebar">
				<!-- Sidebar navigation-->
				<nav class="sidebar-nav">
					<ul id="sidebarnav">
						<!-- User Profile-->
						<li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">首页</span></li>
						<li class="sidebar-item">
							<a class="sidebar-link has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false"><i
								 class="mdi mdi-av-timer"></i><span class="hide-menu">首页 </span></a>
							<ul aria-expanded="false" class="collapse  first-level">
								<li class="sidebar-item">
									<a href="index.html" class="sidebar-link"><i class="mdi mdi-timer-off"></i><span class="hide-menu"> 更换周期 </span></a>
								</li>
								<li class="sidebar-item">
									<a href="analysis.html" class="sidebar-link"><i class="mdi mdi-chart-line"></i><span class="hide-menu"> 销售分析
										</span></a>
								</li>
							</ul>
						</li>
						<li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">业务</span></li>
						<li class="sidebar-item">
							<a class="sidebar-link two-column has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false"><i
								 class="mdi mdi-inbox-arrow-down"></i><span class="hide-menu">订单 </span></a>
							<ul aria-expanded="false" class="collapse first-level">
								<li class="sidebar-item">
									<a href="create_order.html" class="sidebar-link"><i class="mdi mdi-cart-plus"></i><span class="hide-menu"> 创建订单
										</span></a>
								</li>
								<li class="sidebar-item">
									<a href="order_list.html" class="sidebar-link"><i class="mdi mdi-cart"></i><span class="hide-menu"> 查看订单
										</span></a>
								</li>
							</ul>
						</li>
						<li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">客户</span></li>
						<li class="sidebar-item">
							<a class="sidebar-link two-column has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false"><i
								 class="mdi mdi-account-network"></i><span class="hide-menu">客户 </span></a>
							<ul aria-expanded="false" class="collapse first-level">
								<li class="sidebar-item">
									<a href="customer_list.html" class="sidebar-link"><i class="mdi mdi-account-star-variant"></i><span class="hide-menu"> 客户管理
										</span></a>
								</li>
								<li class="sidebar-item">
									<a href="customer_detail.html" class="sidebar-link"><i class="mdi mdi-account-box"></i><span class="hide-menu">
											客户详情 </span></a>
								</li>
							</ul>
						</li>
						<li class="nav-small-cap"><i class="mdi mdi-tune"></i> <span class="hide-menu">设备</span></li>
						<li class="sidebar-item">
							<a class="sidebar-link two-column has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false"><i
								 class="mdi mdi-codepen"></i><span class="hide-menu">设备管理 </span></a>
							<ul aria-expanded="false" class="collapse first-level">
								<li class="sidebar-item">
									<a href="machine.html" class="sidebar-link"><i class="mdi mdi-vector-triangle"></i><span class="hide-menu"> 净水机
										</span></a>
								</li>
							</ul>
						</li>
						<li class="nav-small-cap"><i class="mdi mdi-dots-horizontal"></i> <span class="hide-menu">员工</span></li>
						<li class="sidebar-item">
							<a class="sidebar-link two-column has-arrow waves-effect waves-dark" href="javascript:void(0)" aria-expanded="false"><i
								 class="mdi mdi-bulletin-board"></i><span class="hide-menu">员工管理 </span></a>
							<ul aria-expanded="false" class="collapse first-level">
								<li class="sidebar-item">
									<a href="labour_list.html" class="sidebar-link"><i class="mdi mdi-svg"></i><span class="hide-menu"> 员工列表
										</span></a>
								</li>
								<li class="sidebar-item">
									<a href="labour_detail.html" class="sidebar-link"><i class="mdi mdi-chart-histogram"></i><span class="hide-menu">
											员工详情 </span></a>
								</li>
							</ul>
						</li>
					</ul>
				</nav>
				<!-- End Sidebar navigation -->
			</div>
			<!-- End Sidebar scroll-->
		</aside>
		<!-- ============================================================== -->
		<!-- End Left Sidebar - style you can find in sidebar.scss  -->
		<!-- ============================================================== -->
		<!-- ============================================================== -->
		<!-- Page wrapper  -->
		<!-- ============================================================== -->
		<div class="page-wrapper">

			<!-- ============================================================== -->
			<!-- Container fluid  -->
			<!-- ============================================================== -->
			<div class="container-fluid">
				<!-- ============================================================== -->
				<!-- Start Page Content -->
				<!-- ============================================================== -->
				<!-- Row -->
				<div class="row">
					<!-- Column -->
					<div class="col-lg-4 col-xlg-3 col-md-5">
						<div class="card">
							<div class="card-body">
								<center class="m-t-30"> <img id="customer_avatarUrl" src="assets/images/users/5.jpg" class="rounded-circle"
									 width="150" />
									<h4 class="card-title m-t-10" id="real_name">正在加载...</h4>
								</center>
							</div>
							<div>
								<hr>
							</div>
							<div class="card-body">
								<small class="text-muted">电话1</small>
								<h6 id="mobile_1">正在加载...</h6>
								<small class="text-muted p-t-30 db">电话2</small>
								<h6 id="mobile_2">正在加载...</h6>
								<small class="text-muted p-t-30 db">地址</small>
								<h6 id="address">正在加载...</h6>
							</div>
						</div>
						<div class="card">

							<div class="card-body">
								<h4 class="card-title">
									购买记录
								</h4>
								<hr>
								<div id="orderList">
									<script type="text/template" id="orderTemplate">
										<%if(order.length == 0){%>
											<div class="card-title">该用户没有购买记录</div>
										<%}%>
										<%for(var i=0;i<order.length;i++){ var item = order[i];%>
											<h4>购买机器: <%=item.machine_model%></h4>
											<h5>购买时间: <%=item.sale_time%></h5>
											<h6>购买店铺: <%=item.sale_store%></h6>
											<h6>流水号: <%=item.sale_id%></h6>
										<hr>
										<%}%>
									</script>
								</div>

							</div>
						</div>
					</div>
					<!-- Column -->
					<!-- Column -->
					<div class="col-lg-8 col-xlg-9 col-md-7">
						<div class="card">
							<!-- Tabs -->
							<ul class="nav nav-pills custom-pills" id="pills-tab" role="tablist">
								<li class="nav-item">
									<a class="nav-link active" id="pills-timeline-tab" data-toggle="pill" href="#lvxinTimeLine" role="tab"
									 aria-controls="pills-timeline" aria-selected="true">滤芯</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" id="pills-timeline-tab" data-toggle="pill" href="#peijianTimeLine" role="tab"
									 aria-controls="pills-timeline" aria-selected="false">配件</a>
								</li>
								<li class="nav-item">
									<a class="nav-link" id="pills-setting-tab" data-toggle="pill" href="#customerDetail" role="tab" aria-controls="pills-setting"
									 aria-selected="false">客户更新</a>
								</li>
							</ul>
							<!-- Tabs -->
							<div class="tab-content" id="pills-tabContent">
								<div class="tab-pane fade show active" id="lvxinTimeLine" role="tabpanel" aria-labelledby="pills-timeline-tab">
									<div class="card-body">
										<div class="profiletimeline m-t-0" id="maintenance">
											<script type="text/template" id="maintenanceTemplate">
												<%if(maintenance.length == 0){%>
													<div class="card-title">该用户没有滤芯更换记录</div>
												<%}%>
												<%for(var i=0;i<maintenance.length;i++){ var item = maintenance[i];%>
											
												<div class="sl-item">
													<div class="sl-left"> <img src="<%=item.labour_avatarUrl||'assets/images/users/1.jpg'%>" alt="user" class="rounded-circle" /> </div>
													<div class="sl-right">
														<div>
															<a href="javascript:void(0)" class="link">更换: <%=item.fe_model%></a> <span class="sl-date">订单流水号：<%=item.sale_id%></span>
															<div class="sub_title">处理员工: <%=item.labour_name%></div>
															<%if(item.maintain_record){%>
															<blockquote class="m-t-10">
																	<%=item.maintain_record%>
															</blockquote>
															<%}%>
															<h6>时间: <%=item.maintain_time%></h6>
														</div>
													</div>
												</div>
												<hr>
												<%}%>
											</script>
										</div>
									</div>
								</div>
								<div class="tab-pane fade" id="peijianTimeLine" role="tabpanel" aria-labelledby="pills-timeline-tab">
									<div class="card-body">
										<div class="card-title text-big">增加一条维修</div>
										<div class="addaccmaintain">
											<form id="addAccmaintainForm">
												<div class="form-group">
													<label for="firstName1">选择对应订单</label>
													<select name='sale_id' id="choseorderselect" class="select2 custom-select form-control" style="width: 100%; height:36px;">

														<script id="orderListTemplate" type="text/template">
															<%for(var i=0;i<order.length;i++){var item = order[i];%>
																<option value="<%=item.sale_id%>"><%=item.sale_id%></option>
															<%}%>
														</script>
													</select>
												</div>
												<div class="form-group">
													<label for="firstName1">选择配件</label>
													<select name='accessoryId' id="choseaccessoriesselect" class="select2 custom-select form-control" style="width: 100%; height:36px;">

														<script id="accessoriesListTemplate" type="text/template">
															<%for(var i=0;i<accessories.length;i++){var item = accessories[i];%>
																<option value="<%=item.accessory_id%>"><%=item.accessory_model%></option>
															<%}%>
														</script>
													</select>
												</div>
												<div class="form-group">
													<label for="firstName1">选择派工员工</label>
													<select name='labourId' id="choselabourselect" class="select2 custom-select form-control" style="width: 100%; height:36px;">

														<script id="labourListTemplate" type="text/template">
															<%for(var i=0;i<labourlist.length;i++){var item = labourlist[i];%>
																<option value="<%=item.labour_id%>"><%=item.labour_name%></option>
															<%}%>
														</script>
													</select>
												</div>
											</form>
											<button class="btn waves-effect btn-info" id="addAccmaintainBtn">添加</button>
										</div>
										<hr>
										<h4>配件维修记录:</h4>
										<div class="profiletimeline m-t-0" id="accmaintain">
											<script type="text/template" id="accmaintainTemplate">
												<%if(accmaintain.length == 0){%>
													<div class="card-title">该用户没有配件更换记录</div>
												<%}%>
												<%for(var i=0;i<accmaintain.length;i++){ var item = accmaintain[i];%>
											
												<div class="sl-item">
													<div class="sl-left"> <img src="<%=item.labour_avatarUrl||'assets/images/users/1.jpg'%>" alt="user" class="rounded-circle" /> </div>
													<div class="sl-right">
														<div>
															<a href="javascript:void(0)" class="link">更换: <%=item.accessory_model%></a> <span class="sl-date">订单流水号：<%=item.sale_id%></span>
															<div class="sub_title">处理员工: <%=item.labour_name%></div>
															<%if(item.accmaintain_record){%>
															<blockquote class="m-t-10">
																	<%=item.accmaintain_record%>
															</blockquote>
															<%}%>
															<%if(item.accmaintain_status == 1){%>
															<h6>维修时间: <%=item.finish_time%></h6>
															<%}else{%>
																<h6 class="text-warning">未完成</h6>
																<button type="button" class="btn waves-effect waves-light btn-xs btn-info doitbtn-makesucess" data-accmaintain_id="<%=item.accmaintain_id%>" >设置完成</button>
															<%}%>
														</div>
													</div>
												</div>
												<hr>
												<%}%>	
											</script>
										</div>
									</div>
								</div>
								<div class="tab-pane fade" id="customerDetail" role="tabpanel" aria-labelledby="pills-setting-tab">
									<div class="card-body">

										<form class="form-horizontal form-material" id="customerDetailForm" action="/change">
											<div class="form-group">
												<label class="col-md-12">姓名</label>
												<div class="col-md-12">
													<input type="text" class="form-control form-control-line" name="real_name" id="p_real_name">
												</div>
											</div>
											<div class="form-group">
												<label for="example-email" class="col-md-12">电话1</label>
												<div class="col-md-12">
													<input type="tel" placeholder="" class="form-control form-control-line" name="mobile_1" id="p_mobile_1">
												</div>
											</div>
											<div class="form-group">
												<label for="example-email" class="col-md-12">电话2</label>
												<div class="col-md-12">
													<input type="tel" placeholder="" class="form-control form-control-line" name="mobile_2" id="p_mobile_2">
												</div>
											</div>
											<div class="form-group">
												<label for="example-email" class="col-md-12">区域</label>
												<div class="col-md-12">
													<input type="text" placeholder="" class="form-control form-control-line" name="customer_area" id="p_customer_area">
												</div>
											</div>
											<div class="form-group">
												<label for="example-email" class="col-md-12">详细地址</label>
												<div class="col-md-12">
													<input type="text" placeholder="" class="form-control form-control-line" name="address" id="p_address">
												</div>
											</div>
											<div class="form-group">
												<label class="col-md-12">备注</label>
												<div class="col-md-12">
													<textarea rows="5" class="form-control form-control-line" id="p_remark" name="remark"></textarea>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-12">来源</label>
												<div class="col-sm-12">
													<select id="p_customer_from" name="customer_from" class="form-control form-control-line">
														<option value="店面">店面</option>
														<option value="网购">网购</option>
														<option value="服务">服务</option>
													</select>
												</div>
											</div>
											<div class="form-group">
												<label class="col-sm-12">选择用户星级</label>
												<div class="col-sm-12">
													<div class="form-check form-check-inline">
														<div class="custom-control custom-radio">
															<input type="radio" class="custom-control-input" id="star-1" name="customer_star" value="1">
															<label class="custom-control-label" for="star-1">1</label>
														</div>
													</div>
													<div class="form-check form-check-inline">
														<div class="custom-control custom-radio">
															<input type="radio" class="custom-control-input" id="star-2" name="customer_star" value="2">
															<label class="custom-control-label" for="star-2">2</label>
														</div>
													</div>
													<div class="form-check form-check-inline">
														<div class="custom-control custom-radio">
															<input type="radio" class="custom-control-input" id="star-3" name="customer_star" value="3">
															<label class="custom-control-label" for="star-3">3</label>
														</div>
													</div>
												</div>

											</div>
											<div class="form-group">
												<div class="col-sm-12">
													<button class="btn btn-success" type="button" id="updatebtn">更新</button>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Column -->
				</div>
				<!-- Row -->
				<!-- ============================================================== -->
				<!-- End PAge Content -->
				<!-- ============================================================== -->
				<!-- ============================================================== -->
				<!-- Right sidebar -->
				<!-- ============================================================== -->
				<!-- .right-sidebar -->
				<!-- ============================================================== -->
				<!-- End Right sidebar -->
				<!-- ============================================================== -->
			</div>
			<!-- ============================================================== -->
			<!-- End Container fluid  -->
			<!-- ============================================================== -->
			<!-- ============================================================== -->
			<!-- footer -->
			<!-- ============================================================== -->
			<footer class="footer text-center">
				All Rights Reserved by Nice admin. Designed and Developed by
				<a href="https://wrappixel.com">WrapPixel</a>.
			</footer>
			<!-- ============================================================== -->
			<!-- End footer -->
			<!-- ============================================================== -->
		</div>
		<!-- ============================================================== -->
		<!-- End Page wrapper  -->
		<!-- ============================================================== -->
	</div>
	<!-- ============================================================== -->
	<!-- End Wrapper -->
	<!-- ============================================================== -->

	<!-- ============================================================== -->
	<!-- All Jquery -->
	<!-- ============================================================== -->
	<script src="assets/libs/jquery/dist/jquery.min.js"></script>
	<!-- Bootstrap tether Core JavaScript -->
	<script src="assets/libs/popper.js/dist/umd/popper.min.js"></script>
	<script src="assets/libs/bootstrap/dist/js/bootstrap.min.js"></script>
	<!-- apps -->
	<script src="dist/js/app.min.js"></script>
	<script src="dist/js/app.init.js"></script>
	<script src="dist/js/app-style-switcher.js"></script>
	<!-- slimscrollbar scrollbar JavaScript -->
	<script src="assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
	<script src="assets/extra-libs/sparkline/sparkline.js"></script>
	<!--Wave Effects -->
	<script src="dist/js/waves.js"></script>
	<!--Menu sidebar -->
	<script src="dist/js/sidebarmenu.js"></script>
	<!--Custom JavaScript -->
	<script src="dist/js/custom.min.js"></script>
	<script src="assets/libs/toastr/build/toastr.min.js"></script>
	<!--This page JavaScript -->
	<script src="../../assets/libs/block-ui/jquery.blockUI.js"></script>
	<script src="../../assets/extra-libs/block-ui/block-ui.js"></script>
	<script src="js/adminMsg.js"></script>

	<script src="./dist/js/template-web.js"></script>
	<script>
		function doBolckUI() {
			$.blockUI({
				message: '<i class="fas fa-spin fa-sync text-white"></i><i class="text-white">提交请求中...</i>',
				overlayCSS: {
					backgroundColor: '#000',
					opacity: 0.5,
					cursor: 'wait'
				},
				css: {
					color: '#333',
					border: 0,
					padding: 0,
					backgroundColor: 'transparent'
				},
			})
		}

		function getorder(pars) {
			$.ajax({
				url: '/sales/customerorder',
				data: pars,
				success: function (data, textStatus) {
					var orderlistStr = template('orderListTemplate', data);
					$("#choseorderselect").html(orderlistStr);
				},
				error: function (xhr, textStatus) {
					alert('网络异常')
				}
			})
		}

		function getaccmaintain(pars) {
			//获取配件列表
			console.log("getaccmaintain");
			$.ajax({
				url: '/accessories/getlist',
				success: function (data, textStatus) {
					console.log('accessories list 请求成功' + JSON.stringify(data));

					var accessorieslistStr = template('accessoriesListTemplate', data);
					$("#choseaccessoriesselect").html(accessorieslistStr);
				},
				error: function (xhr, textStatus) {
					alert('网络异常')
				}
			})
		}
		$(document).ready(function () {
			var pars = window.location.href.split('?')[1];
			console.log('参数:' + pars);
			$.ajax({
				url: '/customer/getdetail' + '?' + pars,
				success: function (data, textStatus) {
					console.log('get data: ' + JSON.stringify(data))
					if (data.code == 200) {
						var badge;
						if (data.detail.customer_status == 0) {
							badge = '<span class="badge badge-success badge-pill">  正常</span>';
						} else {
							badge = '<span class="badge badge-danger badge-pill"> 僵尸</span>';
						}
						$("#real_name").html(data.detail.real_name + badge);
						$("#address").html(data.detail.address);
						$("#mobile_1").html(data.detail.mobile_1);
						$("#mobile_2").html(data.detail.mobile_2);
						$("#address").html(data.detail.address);
						$("#customer_avatarUrl").attr('src', data.detail.customer_avatarUrl);
						//input 内容更新
						$("#p_real_name").val(data.detail.real_name);
						$("#p_mobile_1").val(data.detail.mobile_1)
						$("#p_mobile_2").val(data.detail.mobile_2)
						$("#p_address").val(data.detail.address)
						$("#p_customer_area").val(data.detail.customer_area)
						$("#p_customer_from").val(data.detail.customer_from)
						$("#p_remark").val(data.detail.remark)
						$(`input[name='customer_star'][value=${data.detail.customer_star}]`).attr('checked', true)

					} else if (data.code == 302) {
						window.location.href = data.href;
					} else {
						toastr.error(data.msg);
					}
				}
			});
			//滤芯维修记录
			$.ajax({
				url: '/customer/maintenance' + '?' + pars,
				success: function (data, textStatus) {
					if (data.code == 200) {

						var maintenanceStr = template('maintenanceTemplate', data);
						$("#maintenance").html(maintenanceStr);
					} else {
						toastr.warning(data.msg);
					}
				}
			})
			//配件维修记录
			$.ajax({
				url: '/customer/accmaintenance' + '?' + pars,
				success: function (data, textStatus) {
					if (data.code == 200) {

						var accmaintainStr = template('accmaintainTemplate', data);
						$("#accmaintain").html(accmaintainStr);
					} else {
						toastr.warning(data.msg);
					}
				}
			})
			//用户订单
			$.ajax({
				url: '/sales/customerorder' + '?' + pars,
				success: function (data, textStatus) {
					if (data.code == 200) {
						var orderTemplateStr = template('orderTemplate', data);
						$("#orderList").html(orderTemplateStr);
					} else {
						toastr.warning(data.msg);
					}
				}
			})
			//获取工人列表
			$.ajax({
				url: '/labour/getlist',
				success: function (data, textStatus) {
					console.log('labour list 请求成功' + data);

					var lobourlistStr = template('labourListTemplate', data);
					$("#choselabourselect").html(lobourlistStr);
				},
				error: function (xhr, textStatus) {
					alert('网络异常')
				}
			})

			getaccmaintain(pars);
			//获取此用户全部订单
			getorder(pars);
		})
		$(document).ready(function () {

			$("#updatebtn").on('click', function () {
				doBolckUI();
				var formStr = $("#customerDetailForm").serialize();
				console.log(typeof formStr);
				var pars = window.location.href.split('?')[1]
				console.log(formStr);
				$.ajax({
					url: '/customer/change',
					type: "POST",
					data: formStr + "&" + pars,
					success: (data, textStatus) => {
						if (data.code == 200) {
							toastr.success(data.msg)
						} else {
							toastr.error(data.msg)
						}
					},
					error: (error) => {
						toastr.error(JSON.stringify(error));
					},
					complete: () => {
						setTimeout(() => {
							$.unblockUI()
						}, 300);
					}
				})
			})
			$("#addAccmaintainBtn").on('click', function (that) {
				var addaccFormObj = $("#addAccmaintainForm").serialize();
				$.ajax({
					url: '/accessories/addmaintain',
					data: addaccFormObj,
					success: function (data, textStatus) {
						if (data.code == 200) {
							toastr.success(data.msg);
							getaccmaintain(window.location.href.split('?')[1]);
						} else {
							toastr.error(data.msg)
						}
					},
					error: function (error) {
						alert('网络错误')
					}
				})
			})
			$("#accmaintain").on("click", ".doitbtn-makesucess", function (that) {
				var accmaintain_id = $(this).data('accmaintain_id');

				$.ajax({
					url: '/accessories/setaccmaintainfinish',
					data: {
						accmaintain_id: accmaintain_id
					},
					success: function (data) {
						if (data.code == 200) {
							toastr.success(data.msg);
							//getaccmaintain(window.location.href.split('?')[1]);
							setTimeout(() => {
								window.location.reload();		
							}, 1300);
							
						} else {
							toastr.error(data.msg);
						}
					},
					error: function (error) {
						toastr.error('网络异常');
					}
				})
			})
		})
	</script>
</body>

</html>